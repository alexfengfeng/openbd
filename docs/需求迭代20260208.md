# éœ€æ±‚è¿­ä»£ 2026-02-08

## æ¦‚è¿°

æœ¬æ–‡æ¡£è®°å½•äº†å¤šç§Ÿæˆ·éœ€æ±‚ç®¡ç† SaaS ç³»ç»Ÿçš„ä¼˜åŒ–è¿­ä»£è§„åˆ’ï¼Œé‡ç‚¹å…³æ³¨**å¯é…ç½®çœ‹æ¿**å’Œ**å·¥ä½œç©ºé—´çº§åˆ«æ¨¡æ¿**ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ã€‚

**è¿­ä»£å‘¨æœŸ**ï¼š2026-02-08
**è´Ÿè´£äºº**ï¼šç³»ç»Ÿæ¶æ„å¸ˆ
**çŠ¶æ€**ï¼šè§„åˆ’ä¸­

---

## ä¸€ã€éœ€æ±‚èƒŒæ™¯

### 1.1 å½“å‰ç³»ç»Ÿé™åˆ¶

**æ¨¡æ¿ç³»ç»Ÿï¼š**
- âŒ æ¨¡æ¿ç¡¬ç¼–ç åœ¨ `requirement-templates.ts` ä¸­
- âŒ æ‰€æœ‰å·¥ä½œç©ºé—´å…±äº«ç›¸åŒæ¨¡æ¿
- âŒ ç”¨æˆ·æ— æ³•è‡ªå®šä¹‰æˆ–ç¼–è¾‘æ¨¡æ¿

**çœ‹æ¿ç³»ç»Ÿï¼š**
- âŒ çœ‹æ¿åˆ—å›ºå®šä¸º 4 ä¸ªçŠ¶æ€ï¼ˆBACKLOG, TODO, IN_PROGRESS, DONEï¼‰
- âŒ ä¸åŒå·¥ä½œç©ºé—´æ— æ³•é…ç½®ä¸åŒçš„çœ‹æ¿å¸ƒå±€
- âŒ ç¼ºå°‘æ³³é“è§†å›¾ã€WIP é™åˆ¶ç­‰é«˜çº§åŠŸèƒ½

### 1.2 ä¼˜åŒ–ç›®æ ‡

1. **æ¨¡æ¿ç³»ç»Ÿæ•°æ®åŒ–**ï¼šå°† `requirementTemplates` å­˜å…¥æ•°æ®åº“ï¼Œæ”¯æŒå·¥ä½œç©ºé—´çº§åˆ«é…ç½®
2. **çœ‹æ¿å¯é…ç½®åŒ–**ï¼šæ”¯æŒè‡ªå®šä¹‰åˆ—é…ç½®ã€æ³³é“è§†å›¾ã€WIP é™åˆ¶
3. **å¤šå·¥ä½œç©ºé—´å·®å¼‚åŒ–**ï¼šä¸åŒå·¥ä½œç©ºé—´å¯ä»¥è®¾ç½®ä¸åŒçš„æ¨¡æ¿å’Œçœ‹æ¿é…ç½®

---

## äºŒã€åŠŸèƒ½éœ€æ±‚åˆ†æ

### 2.1 æ¨¡æ¿ç³»ç»ŸåŠŸèƒ½éœ€æ±‚

#### åŠŸèƒ½ç‚¹ 1ï¼šå…¨å±€æ¨¡æ¿åº“
- ç³»ç»Ÿé¢„ç½®ä¸€å¥—å…¨å±€æ¨¡æ¿ï¼ˆBug ä¿®å¤ã€åŠŸèƒ½éœ€æ±‚ã€ä¼˜åŒ–/æ€§èƒ½ç­‰ï¼‰
- æ–°å·¥ä½œç©ºé—´é»˜è®¤ç»§æ‰¿å…¨å±€æ¨¡æ¿
- ç®¡ç†å‘˜å¯ç®¡ç†å…¨å±€æ¨¡æ¿

#### åŠŸèƒ½ç‚¹ 2ï¼šå·¥ä½œç©ºé—´è‡ªå®šä¹‰æ¨¡æ¿
- æ¯ä¸ªå·¥ä½œç©ºé—´å¯åˆ›å»ºè‡ªå®šä¹‰æ¨¡æ¿
- å¯ç¼–è¾‘ã€ç¦ç”¨ã€åˆ é™¤å·¥ä½œç©ºé—´æ¨¡æ¿
- æ¨¡æ¿æ”¯æŒåˆ†ç±»ï¼ˆbug, feature, optimization, customï¼‰

#### åŠŸèƒ½ç‚¹ 3ï¼šæ¨¡æ¿ç®¡ç†ç•Œé¢
- æ¨¡æ¿åˆ—è¡¨ï¼ˆå±•ç¤ºåç§°ã€åˆ†ç±»ã€çŠ¶æ€ï¼‰
- åˆ›å»º/ç¼–è¾‘æ¨¡æ¿å¼¹çª—
- æ¨¡æ¿é¢„è§ˆåŠŸèƒ½

### 2.2 çœ‹æ¿ç³»ç»ŸåŠŸèƒ½éœ€æ±‚

#### åŠŸèƒ½ç‚¹ 1ï¼šè‡ªå®šä¹‰çœ‹æ¿åˆ—
- æ”¯æŒæ·»åŠ /åˆ é™¤/é‡å‘½åçœ‹æ¿åˆ—
- æ”¯æŒæ‹–æ‹½è°ƒæ•´åˆ—é¡ºåº
- åˆ—çŠ¶æ€æ˜ å°„åˆ°æ•°æ®åº“ RequirementStatus

#### åŠŸèƒ½ç‚¹ 2ï¼šæ³³é“è§†å›¾
- æ”¯æŒæŒ‰ç»´åº¦åˆ†ç»„ï¼šè´Ÿè´£äººï¼ˆassigneeï¼‰ã€ä¼˜å…ˆçº§ï¼ˆpriorityï¼‰ã€æ ‡ç­¾ï¼ˆtagsï¼‰
- æ³³é“ä¸åˆ—ç»„åˆå½¢æˆäºŒç»´çŸ©é˜µè§†å›¾

#### åŠŸèƒ½ç‚¹ 3ï¼šWIP é™åˆ¶
- æ¯åˆ—å¯è®¾ç½®æœ€å¤§å¡ç‰‡æ•°é‡ï¼ˆWIP Limitï¼‰
- è¶…å‡ºé™åˆ¶æ—¶è§†è§‰æç¤ºï¼ˆçº¢è‰²è­¦å‘Šï¼‰
- ç»Ÿè®¡é¢æ¿æ˜¾ç¤ºå½“å‰æ•°é‡ vs é™åˆ¶

#### åŠŸèƒ½ç‚¹ 4ï¼šçœ‹æ¿é…ç½®ç•Œé¢
- åˆ—é…ç½®å™¨ï¼ˆæ‹–æ‹½æ’åºã€å¢åˆ æ”¹ï¼‰
- æ³³é“é€‰æ‹©å™¨
- WIP é™åˆ¶è®¾ç½®

---

## ä¸‰ã€æ•°æ®åº“è®¾è®¡

### 3.1 æ¨¡æ¿è¡¨è®¾è®¡

```prisma
// prisma/schema.prisma

model RequirementTemplate {
  id          String   @id @default(uuid())
  workspaceId String?  @map("workspace_id")  // null = å…¨å±€æ¨¡æ¿
  name        String   @db.VarChar(100)
  prompt      String   @db.Text
  category    String   @db.VarChar(50)       // bug, feature, optimization, custom
  isActive    Boolean  @default(true)        // æ˜¯å¦å¯ç”¨
  order       Int      @default(0)           // æ’åº
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  workspace   Workspace? @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@map("requirement_templates")
  @@index([workspaceId])
  @@index([category])
}
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `workspaceId` | String? | null è¡¨ç¤ºå…¨å±€æ¨¡æ¿ï¼Œé null è¡¨ç¤ºå·¥ä½œç©ºé—´ç§æœ‰æ¨¡æ¿ |
| `name` | String | æ¨¡æ¿åç§°ï¼Œå¦‚ "Bug ä¿®å¤æ¨¡æ¿" |
| `prompt` | String | é¢„å¡«å……çš„æç¤ºæ–‡æœ¬ |
| `category` | String | åˆ†ç±»ï¼šbug / feature / optimization / custom |
| `isActive` | Boolean | æ˜¯å¦å¯ç”¨ï¼ˆè½¯åˆ é™¤ï¼‰ |
| `order` | Int | æ’åºæƒé‡ |

**å…³ç³»è¯´æ˜ï¼š**

- `workspaceId` ä¸º null æ—¶ï¼Œè¡¨ç¤ºå…¨å±€æ¨¡æ¿ï¼Œæ‰€æœ‰å·¥ä½œç©ºé—´å¯è§
- `workspaceId` éç©ºæ—¶ï¼Œè¡¨ç¤ºå·¥ä½œç©ºé—´ç§æœ‰æ¨¡æ¿ï¼Œä»…è¯¥å·¥ä½œç©ºé—´å¯è§
- åˆ é™¤å·¥ä½œç©ºé—´æ—¶ï¼Œçº§è”åˆ é™¤è¯¥å·¥ä½œç©ºé—´çš„æ‰€æœ‰æ¨¡æ¿

### 3.2 çœ‹æ¿é…ç½®è¡¨è®¾è®¡

```prisma
model KanbanConfig {
  id            String   @id @default(uuid())
  workspaceId   String   @unique @map("workspace_id")
  columnConfig  Json     @map("column_config")   // åˆ—é…ç½®
  swimlaneBy    String?  @map("swimlane_by")     // æ³³é“åˆ†ç»„ç»´åº¦
  wipLimits     Json?    @map("wip_limits")      // WIP é™åˆ¶
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  workspace     Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@map("kanban_configs")
}

// columnConfig æ•°æ®ç»“æ„ç¤ºä¾‹ï¼š
// [
//   { "id": "backlog", "name": "å¾…åŠäº‹é¡¹", "status": "BACKLOG", "color": "#6B7280", "order": 0 },
//   { "id": "todo", "name": "è¿›è¡Œä¸­", "status": "TODO", "color": "#3B82F6", "order": 1 },
//   { "id": "review", "name": "å®¡æ ¸ä¸­", "status": "IN_PROGRESS", "color": "#F59E0B", "order": 2 },
//   { "id": "done", "name": "å·²å®Œæˆ", "status": "DONE", "color": "#10B981", "order": 3 }
// ]

// wipLimits æ•°æ®ç»“æ„ç¤ºä¾‹ï¼š
// {
//   "todo": 5,
//   "review": 3
// }

// swimlaneBy å¯é€‰å€¼ï¼š
// null - ä¸ä½¿ç”¨æ³³é“
// "assignee" - æŒ‰è´Ÿè´£äººåˆ†ç»„
// "priority" - æŒ‰ä¼˜å…ˆçº§åˆ†ç»„
// "tags" - æŒ‰æ ‡ç­¾åˆ†ç»„
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `columnConfig` | Json | åˆ—é…ç½®æ•°ç»„ï¼ŒåŒ…å« id, name, status, color, order |
| `swimlaneBy` | String? | æ³³é“åˆ†ç»„ç»´åº¦ï¼Œnull è¡¨ç¤ºä¸ä½¿ç”¨æ³³é“ |
| `wipLimits` | Json? | WIP é™åˆ¶ï¼Œé”®ä¸ºåˆ— idï¼Œå€¼ä¸ºæœ€å¤§æ•°é‡ |

**å…³ç³»è¯´æ˜ï¼š**

- æ¯ä¸ªå·¥ä½œç©ºé—´æœ‰å”¯ä¸€çš„ KanbanConfigï¼ˆé€šè¿‡ `@unique` çº¦æŸï¼‰
- åˆ é™¤å·¥ä½œç©ºé—´æ—¶ï¼Œçº§è”åˆ é™¤è¯¥å·¥ä½œç©ºé—´çš„çœ‹æ¿é…ç½®
- `columnConfig` ä¸­çš„ `status` å¿…é¡»æ˜ å°„åˆ° `RequirementStatus` æšä¸¾

### 3.3 æ•°æ®æ¨¡å‹æ›´æ–°

éœ€è¦åœ¨ `Workspace` æ¨¡å‹ä¸­æ·»åŠ å…³ç³»ï¼š

```prisma
model Workspace {
  // ... ç°æœ‰å­—æ®µ

  // æ–°å¢å…³ç³»
  requirementTemplates RequirementTemplate[]
  kanbanConfig          KanbanConfig?
}
```

### 3.4 æ•°æ®åº“è¿ç§»è„šæœ¬

```sql
-- åˆ›å»º requirement_templates è¡¨
CREATE TABLE requirement_templates (
  id CHAR(36) PRIMARY KEY,
  workspace_id CHAR(36) NULL,
  name VARCHAR(100) NOT NULL,
  prompt TEXT NOT NULL,
  category VARCHAR(50) NOT NULL,
  is_active BOOLEAN DEFAULT TRUE,
  `order` INT DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_workspace_id (workspace_id),
  INDEX idx_category (category),
  FOREIGN KEY (workspace_id) REFERENCES workspaces(id) ON DELETE CASCADE
);

-- åˆ›å»º kanban_configs è¡¨
CREATE TABLE kanban_configs (
  id CHAR(36) PRIMARY KEY,
  workspace_id CHAR(36) NOT NULL UNIQUE,
  column_config JSON NOT NULL,
  swimlane_by VARCHAR(50) NULL,
  wip_limits JSON NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (workspace_id) REFERENCES workspaces(id) ON DELETE CASCADE
);

-- æ’å…¥é»˜è®¤å…¨å±€æ¨¡æ¿
INSERT INTO requirement_templates (id, workspace_id, name, prompt, category, `order`) VALUES
  (UUID(), NULL, 'Bug ä¿®å¤', 'ã€é—®é¢˜ç°è±¡ã€‘\n\nã€å¤ç°æ­¥éª¤ã€‘\n1.\n2.\n3.\n\nã€æœŸæœ›è¡Œä¸ºã€‘\n\nã€å®é™…è¡Œä¸ºã€‘\n\nã€ç¯å¢ƒä¿¡æ¯ã€‘', 'bug', 0),
  (UUID(), NULL, 'åŠŸèƒ½éœ€æ±‚', 'ã€èƒŒæ™¯ã€‘\n\nã€ç›®æ ‡ã€‘\n\nã€ç”¨æˆ·æ•…äº‹ã€‘\nä½œä¸º <è§’è‰²>ï¼Œæˆ‘æƒ³è¦ <åŠŸèƒ½>ï¼Œä»¥ä¾¿ <ä»·å€¼>ã€‚\n\nã€éªŒæ”¶æ ‡å‡†ã€‘', 'feature', 1),
  (UUID(), NULL, 'ä¼˜åŒ–/æ€§èƒ½', 'ã€ç°çŠ¶ã€‘\n\nã€é—®é¢˜ã€‘\n\nã€ç›®æ ‡æŒ‡æ ‡ã€‘\n\nã€æ”¹è¿›æ–¹æ¡ˆã€‘', 'optimization', 2);

-- ä¸ºç°æœ‰å·¥ä½œç©ºé—´åˆ›å»ºé»˜è®¤çœ‹æ¿é…ç½®
INSERT INTO kanban_configs (id, workspace_id, column_config)
SELECT
  UUID(),
  id,
  '[
    {"id": "backlog", "name": "å¾…åŠäº‹é¡¹", "status": "BACKLOG", "color": "#6B7280", "order": 0},
    {"id": "todo", "name": "è¿›è¡Œä¸­", "status": "TODO", "color": "#3B82F6", "order": 1},
    {"id": "review", "name": "å®¡æ ¸ä¸­", "status": "IN_PROGRESS", "color": "#F59E0B", "order": 2},
    {"id": "done", "name": "å·²å®Œæˆ", "status": "DONE", "color": "#10B981", "order": 3}
  ]'
FROM workspaces;
```

---

## å››ã€API è®¾è®¡

### 4.1 æ¨¡æ¿ç®¡ç† API

#### GET /api/templates

è·å–æ¨¡æ¿åˆ—è¡¨ï¼ˆå…¨å±€æ¨¡æ¿ + å·¥ä½œç©ºé—´ç§æœ‰æ¨¡æ¿ï¼‰

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| `workspaceId` | string | æ˜¯ | å·¥ä½œç©ºé—´ ID |
| `category` | string | å¦ | åˆ†ç±»ç­›é€‰ |
| `includeGlobal` | boolean | å¦ | æ˜¯å¦åŒ…å«å…¨å±€æ¨¡æ¿ï¼Œé»˜è®¤ true |

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "templates": [
    {
      "id": "uuid-1",
      "workspaceId": null,
      "name": "Bug ä¿®å¤",
      "prompt": "ã€é—®é¢˜ç°è±¡ã€‘\n\n...",
      "category": "bug",
      "isActive": true,
      "order": 0,
      "isGlobal": true
    },
    {
      "id": "uuid-2",
      "workspaceId": "workspace-uuid",
      "name": "å‰ç«¯ Bug æ¨¡æ¿",
      "prompt": "...",
      "category": "custom",
      "isActive": true,
      "order": 0,
      "isGlobal": false
    }
  ]
}
```

#### POST /api/templates

åˆ›å»ºæ–°æ¨¡æ¿

**æƒé™è¦æ±‚ï¼š** MEMBER åŠä»¥ä¸Š

**è¯·æ±‚ä½“ï¼š**

```json
{
  "workspaceId": "workspace-uuid",  // null è¡¨ç¤ºåˆ›å»ºå…¨å±€æ¨¡æ¿ï¼ˆéœ€ ADMIN æƒé™ï¼‰
  "name": "æ–°æ¨¡æ¿",
  "prompt": "æ¨¡æ¿å†…å®¹...",
  "category": "custom"
}
```

**å“åº”ï¼š** åˆ›å»ºçš„æ¨¡æ¿å¯¹è±¡

#### PUT /api/templates/:id

æ›´æ–°æ¨¡æ¿

**æƒé™è¦æ±‚ï¼š**
- å…¨å±€æ¨¡æ¿ï¼šADMIN
- å·¥ä½œç©ºé—´æ¨¡æ¿ï¼šè¯¥å·¥ä½œç©ºé—´çš„ ADMIN/OWNER

**è¯·æ±‚ä½“ï¼š**

```json
{
  "name": "æ›´æ–°åçš„åç§°",
  "prompt": "æ›´æ–°åçš„å†…å®¹",
  "category": "feature",
  "isActive": true
}
```

#### DELETE /api/templates/:id

åˆ é™¤æ¨¡æ¿ï¼ˆè½¯åˆ é™¤ï¼Œè®¾ç½® `isActive = false`ï¼‰

**æƒé™è¦æ±‚ï¼š** åŒ PUT

### 4.2 çœ‹æ¿é…ç½® API

#### GET /api/workspaces/:workspaceId/kanban-config

è·å–çœ‹æ¿é…ç½®

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "config": {
    "id": "uuid",
    "workspaceId": "workspace-uuid",
    "columnConfig": [
      { "id": "backlog", "name": "å¾…åŠ", "status": "BACKLOG", "color": "#6B7280", "order": 0 },
      { "id": "todo", "name": "è¿›è¡Œä¸­", "status": "TODO", "color": "#3B82F6", "order": 1 }
    ],
    "swimlaneBy": "assignee",
    "wipLimits": { "todo": 5 }
  }
}
```

#### PUT /api/workspaces/:workspaceId/kanban-config

æ›´æ–°çœ‹æ¿é…ç½®

**æƒé™è¦æ±‚ï¼š** è¯¥å·¥ä½œç©ºé—´çš„ ADMIN/OWNER

**è¯·æ±‚ä½“ï¼š**

```json
{
  "columnConfig": [...],
  "swimlaneBy": "priority",
  "wipLimits": { "todo": 3, "review": 2 }
}
```

#### POST /api/workspaces/:workspaceId/kanban-config/reset

é‡ç½®ä¸ºé»˜è®¤é…ç½®

**æƒé™è¦æ±‚ï¼š** ADMIN/OWNER

### 4.3 æ–‡ä»¶è·¯å¾„è§„åˆ’

```
src/app/api/
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ route.ts              # GET (list), POST (create)
â”‚   â””â”€â”€ [id]/
â”‚       â””â”€â”€ route.ts          # PUT (update), DELETE (delete)
â””â”€â”€ workspaces/
    â””â”€â”€ [workspaceId]/
        â””â”€â”€ kanban-config/
            â”œâ”€â”€ route.ts      # GET, PUT
            â””â”€â”€ reset/
                â””â”€â”€ route.ts  # POST (reset to default)
```

---

## äº”ã€å‰ç«¯ç»„ä»¶è®¾è®¡

### 5.1 æ¨¡æ¿ç®¡ç†ç»„ä»¶

#### TemplateManager.tsx

æ¨¡æ¿ç®¡ç†ä¸»ç»„ä»¶

```typescript
interface TemplateManagerProps {
  workspaceId: string;
}

export function TemplateManager({ workspaceId }: TemplateManagerProps) {
  // çŠ¶æ€
  const [templates, setTemplates] = useState<Template[]>([]);
  const [filter, setFilter] = useState<'all' | 'global' | 'custom'>('all');

  // åŠŸèƒ½
  const handleCreate = () => { /* æ‰“å¼€åˆ›å»ºå¼¹çª— */ };
  const handleEdit = (template: Template) => { /* æ‰“å¼€ç¼–è¾‘å¼¹çª— */ };
  const handleDelete = (id: string) => { /* è½¯åˆ é™¤ */ };
  const handleToggleActive = (id: string, isActive: boolean) => { /* å¯ç”¨/ç¦ç”¨ */ };

  return (
    <div className="space-y-4">
      {/* è¿‡æ»¤å™¨ */}
      <Tabs value={filter} onValueChange={setFilter}>
        <TabsList>
          <TabsTrigger value="all">å…¨éƒ¨</TabsTrigger>
          <TabsTrigger value="global">å…¨å±€æ¨¡æ¿</TabsTrigger>
          <TabsTrigger value="custom">è‡ªå®šä¹‰æ¨¡æ¿</TabsTrigger>
        </TabsList>
      </Tabs>

      {/* æ¨¡æ¿åˆ—è¡¨ */}
      <div className="grid gap-4">
        {templates.map(template => (
          <TemplateCard
            key={template.id}
            template={template}
            onEdit={handleEdit}
            onDelete={handleDelete}
            onToggleActive={handleToggleActive}
          />
        ))}
      </div>

      {/* åˆ›å»ºæŒ‰é’® */}
      <Button onClick={handleCreate}>
        <Plus className="h-4 w-4 mr-2" />
        åˆ›å»ºæ¨¡æ¿
      </Button>
    </div>
  );
}
```

#### TemplateCard.tsx

æ¨¡æ¿å¡ç‰‡ç»„ä»¶

```typescript
interface TemplateCardProps {
  template: Template;
  onEdit: (template: Template) => void;
  onDelete: (id: string) => void;
  onToggleActive: (id: string, isActive: boolean) => void;
}

export function TemplateCard({ template, onEdit, onDelete, onToggleActive }: TemplateCardProps) {
  return (
    <Card className={template.isActive ? '' : 'opacity-50'}>
      <CardHeader>
        <div className="flex items-center justify-between">
          <CardTitle className="flex items-center gap-2">
            {template.name}
            {template.isGlobal && <Badge variant="secondary">å…¨å±€</Badge>}
            <Badge>{getCategoryLabel(template.category)}</Badge>
          </CardTitle>
          <Switch
            checked={template.isActive}
            onCheckedChange={(checked) => onToggleActive(template.id, checked)}
          />
        </div>
      </CardHeader>
      <CardContent>
        <pre className="text-sm bg-muted p-4 rounded overflow-auto max-h-40">
          {template.prompt}
        </pre>
        <div className="flex gap-2 mt-4">
          <Button size="sm" variant="outline" onClick={() => onEdit(template)}>
            ç¼–è¾‘
          </Button>
          <Button size="sm" variant="destructive" onClick={() => onDelete(template.id)}>
            åˆ é™¤
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}
```

#### TemplateFormDialog.tsx

åˆ›å»º/ç¼–è¾‘æ¨¡æ¿å¼¹çª—

```typescript
interface TemplateFormDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  template?: Template;  // æœ‰å€¼è¡¨ç¤ºç¼–è¾‘ï¼Œæ— å€¼è¡¨ç¤ºåˆ›å»º
  workspaceId: string;
  onSuccess: () => void;
}

export function TemplateFormDialog({
  open,
  onOpenChange,
  template,
  workspaceId,
  onSuccess
}: TemplateFormDialogProps) {
  const form = useForm({
    resolver: zodResolver(TemplateSchema),
    defaultValues: template ?? {
      name: '',
      prompt: '',
      category: 'custom'
    }
  });

  const handleSubmit = async (data: TemplateFormData) => {
    const url = template ? `/api/templates/${template.id}` : '/api/templates';
    const method = template ? 'PUT' : 'POST';

    await fetch(url, {
      method,
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ ...data, workspaceId })
    });

    onSuccess();
    onOpenChange(false);
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-2xl">
        <DialogHeader>
          <DialogTitle>{template ? 'ç¼–è¾‘æ¨¡æ¿' : 'åˆ›å»ºæ¨¡æ¿'}</DialogTitle>
        </DialogHeader>
        <Form {...form}>
          <form onSubmit={form.handleSubmit(handleSubmit)} className="space-y-4">
            <FormField
              control={form.control}
              name="name"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>æ¨¡æ¿åç§°</FormLabel>
                  <FormControl>
                    <Input {...field} placeholder="ä¾‹å¦‚ï¼šBug ä¿®å¤æ¨¡æ¿" />
                  </FormControl>
                </FormItem>
              )}
            />
            <FormField
              control={form.control}
              name="category"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>åˆ†ç±»</FormLabel>
                  <Select onValueChange={field.onChange} defaultValue={field.value}>
                    <FormControl>
                      <SelectTrigger>
                        <SelectValue />
                      </SelectTrigger>
                    </FormControl>
                    <SelectContent>
                      <SelectItem value="bug">Bug ä¿®å¤</SelectItem>
                      <SelectItem value="feature">åŠŸèƒ½éœ€æ±‚</SelectItem>
                      <SelectItem value="optimization">ä¼˜åŒ–/æ€§èƒ½</SelectItem>
                      <SelectItem value="custom">è‡ªå®šä¹‰</SelectItem>
                    </SelectContent>
                  </Select>
                </FormItem>
              )}
            />
            <FormField
              control={form.control}
              name="prompt"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>æ¨¡æ¿å†…å®¹</FormLabel>
                  <FormControl>
                    <Textarea {...field} rows={10} placeholder="è¾“å…¥æ¨¡æ¿å†…å®¹..." />
                  </FormControl>
                </FormItem>
              )}
            />
            <DialogFooter>
              <Button type="submit">
                {template ? 'ä¿å­˜' : 'åˆ›å»º'}
              </Button>
            </DialogFooter>
          </form>
        </Form>
      </DialogContent>
    </Dialog>
  );
}
```

### 5.2 çœ‹æ¿é…ç½®ç»„ä»¶

#### KanbanConfigPanel.tsx

çœ‹æ¿é…ç½®é¢æ¿

```typescript
interface KanbanConfigPanelProps {
  workspaceId: string;
  open: boolean;
  onOpenChange: (open: boolean) => void;
}

export function KanbanConfigPanel({ workspaceId, open, onOpenChange }: KanbanConfigPanelProps) {
  const [config, setConfig] = useState<KanbanConfig | null>(null);
  const [activeTab, setActiveTab] = useState<'columns' | 'swimlane' | 'wip'>('columns');

  // å­ç»„ä»¶
  const ColumnConfigurator = () => (
    <div>
      {/* åˆ—é…ç½®å™¨ */}
      <ColumnList
        columns={config.columnConfig}
        onAdd={handleAddColumn}
        onEdit={handleEditColumn}
        onDelete={handleDeleteColumn}
        onReorder={handleReorderColumns}
      />
    </div>
  );

  const SwimlaneSelector = () => (
    <div>
      <RadioGroup value={config.swimlaneBy ?? ''} onValueChange={handleSetSwimlane}>
        <div className="flex items-center space-x-2">
          <RadioGroupItem value="" id="none" />
          <Label htmlFor="none">ä¸ä½¿ç”¨æ³³é“</Label>
        </div>
        <div className="flex items-center space-x-2">
          <RadioGroupItem value="assignee" id="assignee" />
          <Label htmlFor="assignee">æŒ‰è´Ÿè´£äºº</Label>
        </div>
        <div className="flex items-center space-x-2">
          <RadioGroupItem value="priority" id="priority" />
          <Label htmlFor="priority">æŒ‰ä¼˜å…ˆçº§</Label>
        </div>
      </RadioGroup>
    </div>
  );

  const WipLimitsEditor = () => (
    <div>
      {config.columnConfig.map(column => (
        <div key={column.id} className="flex items-center gap-4">
          <span className="w-32">{column.name}</span>
          <Input
            type="number"
            min="1"
            value={config.wipLimits?.[column.id] ?? ''}
            onChange={(e) => handleSetWipLimit(column.id, parseInt(e.target.value) || null)}
            placeholder="æ— é™åˆ¶"
            className="w-24"
          />
        </div>
      ))}
    </div>
  );

  return (
    <Sheet open={open} onOpenChange={onOpenChange}>
      <SheetContent className="w-full sm:max-w-xl">
        <SheetHeader>
          <SheetTitle>çœ‹æ¿é…ç½®</SheetTitle>
        </SheetHeader>
        <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as any)}>
          <TabsList className="w-full">
            <TabsTrigger value="columns" className="flex-1">åˆ—é…ç½®</TabsTrigger>
            <TabsTrigger value="swimlane" className="flex-1">æ³³é“</TabsTrigger>
            <TabsTrigger value="wip" className="flex-1">WIP é™åˆ¶</TabsTrigger>
          </TabsList>
          <TabsContent value="columns"><ColumnConfigurator /></TabsContent>
          <TabsContent value="swimlane"><SwimlaneSelector /></TabsContent>
          <TabsContent value="wip"><WipLimitsEditor /></TabsContent>
        </Tabs>
        <Button onClick={handleSave} className="w-full mt-4">ä¿å­˜é…ç½®</Button>
      </SheetContent>
    </Sheet>
  );
}
```

#### ColumnConfigItem.tsx

åˆ—é…ç½®é¡¹ï¼ˆæ”¯æŒæ‹–æ‹½æ’åºï¼‰

```typescript
interface ColumnConfigItemProps {
  column: ColumnConfig;
  onEdit: (column: ColumnConfig) => void;
  onDelete: (id: string) => void;
}

export function ColumnConfigItem({ column, onEdit, onDelete }: ColumnConfigItemProps) {
  const { attributes, listeners, setNodeRef, transform, transition, isDragging } =
    useSortable({ id: column.id });

  const style = { transform: CSS.Transform.toString(transform), transition };

  return (
    <div
      ref={setNodeRef}
      style={style}
      className={cn(
        "flex items-center gap-4 p-4 bg-card rounded-lg border",
        isDragging && "opacity-50"
      )}
    >
      <div {...attributes} {...listeners} className="cursor-grab">
        <GripVertical className="h-5 w-5 text-muted-foreground" />
      </div>
      <Input value={column.name} onChange={(e) => onEdit({ ...column, name: e.target.value })} />
      <Input
        type="color"
        value={column.color}
        onChange={(e) => onEdit({ ...column, color: e.target.value })}
        className="w-16 h-10"
      />
      <Select value={column.status} onValueChange={(v) => onEdit({ ...column, status: v })}>
        <SelectTrigger className="w-40">
          <SelectValue />
        </SelectTrigger>
        <SelectContent>
          <SelectItem value="BACKLOG">BACKLOG</SelectItem>
          <SelectItem value="TODO">TODO</SelectItem>
          <SelectItem value="IN_PROGRESS">IN_PROGRESS</SelectItem>
          <SelectItem value="DONE">DONE</SelectItem>
        </SelectContent>
      </Select>
      <Button size="icon" variant="ghost" onClick={() => onDelete(column.id)}>
        <Trash2 className="h-4 w-4" />
      </Button>
    </div>
  );
}
```

### 5.3 çœ‹æ¿è§†å›¾ç»„ä»¶æ›´æ–°

#### DraggableBoard.tsx (æ›´æ–°)

éœ€è¦æ”¯æŒä» KanbanConfig è¯»å–é…ç½®å¹¶æ¸²æŸ“

```typescript
export function DraggableBoard({ workspaceId }: { workspaceId: string }) {
  const [config, setConfig] = useState<KanbanConfig | null>(null);

  useEffect(() => {
    // è·å–çœ‹æ¿é…ç½®
    fetch(`/api/workspaces/${workspaceId}/kanban-config`)
      .then(res => res.json())
      .then(data => setConfig(data.config));
  }, [workspaceId]);

  // æ ¹æ® config.columnConfig æ¸²æŸ“åˆ—
  const columns = config?.columnConfig ?? defaultColumnConfig;

  // æ³³é“é€»è¾‘
  const swimlaneGroups = useMemo(() => {
    if (!config?.swimlaneBy) return null;

    return groupBy(requirements, config.swimlaneBy);
  }, [requirements, config?.swimlaneBy]);

  if (config?.swimlaneBy) {
    // æ³³é“è§†å›¾æ¸²æŸ“
    return (
      <div className="space-y-6">
        {Object.entries(swimlaneGroups).map(([groupKey, groupItems]) => (
          <div key={groupKey}>
            <h3 className="font-semibold mb-2">{groupKey}</h3>
            <BoardColumns columns={columns} items={groupItems} />
          </div>
        ))}
      </div>
    );
  }

  // æ ‡å‡†è§†å›¾
  return <BoardColumns columns={columns} items={requirements} />;
}
```

### 5.4 AIRequirementCreator ç»„ä»¶æ›´æ–°

éœ€è¦ä»æ•°æ®åº“è¯»å–æ¨¡æ¿è€Œéç¡¬ç¼–ç 

```typescript
// æ›´æ–°å‰
import { requirementTemplates } from '@/lib/templates/requirement-templates';

// æ›´æ–°å
const [templates, setTemplates] = useState<Template[]>([]);

useEffect(() => {
  fetch(`/api/templates?workspaceId=${workspaceId}`)
    .then(res => res.json())
    .then(data => setTemplates(data.templates));
}, [workspaceId]);

// æ¸²æŸ“æ—¶ä½¿ç”¨ templates è€Œé requirementTemplates
<Select>
  <SelectContent>
    {templates.map(t => (
      <SelectItem key={t.id} value={t.id}>{t.name}</SelectItem>
    ))}
  </SelectContent>
</Select>
```

### 5.5 ç»„ä»¶æ–‡ä»¶è·¯å¾„è§„åˆ’

```
src/components/
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ TemplateManager.tsx          # æ¨¡æ¿ç®¡ç†ä¸»ç»„ä»¶
â”‚   â”œâ”€â”€ TemplateCard.tsx             # æ¨¡æ¿å¡ç‰‡
â”‚   â”œâ”€â”€ TemplateFormDialog.tsx       # åˆ›å»º/ç¼–è¾‘å¼¹çª—
â”‚   â””â”€â”€ TemplateSelector.tsx         # æ¨¡æ¿é€‰æ‹©å™¨ï¼ˆåœ¨ AI åˆ›å»ºå™¨ä¸­ä½¿ç”¨ï¼‰
â”‚
â”œâ”€â”€ kanban/
â”‚   â”œâ”€â”€ KanbanConfigPanel.tsx        # çœ‹æ¿é…ç½®é¢æ¿
â”‚   â”œâ”€â”€ ColumnConfigurator.tsx       # åˆ—é…ç½®å™¨
â”‚   â”œâ”€â”€ ColumnConfigItem.tsx         # åˆ—é…ç½®é¡¹
â”‚   â”œâ”€â”€ SwimlaneSelector.tsx         # æ³³é“é€‰æ‹©å™¨
â”‚   â””â”€â”€ WipLimitsEditor.tsx          # WIP é™åˆ¶ç¼–è¾‘å™¨
â”‚
â””â”€â”€ requirements/
    â”œâ”€â”€ DraggableBoard.tsx           # æ›´æ–°ï¼šæ”¯æŒé…ç½®é©±åŠ¨
    â””â”€â”€ RequirementBoard.tsx         # æ›´æ–°ï¼šæ·»åŠ é…ç½®å…¥å£
```

---

## å…­ã€å®æ–½è®¡åˆ’

### 6.1 Phase 1ï¼šæ•°æ®åº“ä¸ APIï¼ˆ1-2 å¤©ï¼‰

| ä»»åŠ¡ | æ–‡ä»¶ | å·¥ä½œé‡ |
|------|------|--------|
| æ›´æ–° Prisma Schema | `prisma/schema.prisma` | 1h |
| ç¼–å†™è¿ç§»è„šæœ¬ | `prisma/migrations/` | 1h |
| åˆ›å»ºç§å­æ•°æ® | `prisma/seed.ts` | 1h |
| å®ç°æ¨¡æ¿ API | `src/app/api/templates/` | 3h |
| å®ç°çœ‹æ¿é…ç½® API | `src/app/api/workspaces/[id]/kanban-config/` | 3h |

### 6.2 Phase 2ï¼šæ¨¡æ¿ç®¡ç†åŠŸèƒ½ï¼ˆ2-3 å¤©ï¼‰

| ä»»åŠ¡ | ç»„ä»¶ | å·¥ä½œé‡ |
|------|------|--------|
| åˆ›å»ºæ¨¡æ¿ç®¡ç†é¡µé¢ | `src/app/(dashboard)/workspaces/[id]/templates/page.tsx` | 2h |
| å®ç° TemplateManager | `src/components/templates/TemplateManager.tsx` | 3h |
| å®ç° TemplateCard | `src/components/templates/TemplateCard.tsx` | 2h |
| å®ç° TemplateFormDialog | `src/components/templates/TemplateFormDialog.tsx` | 3h |
| æ›´æ–° AIRequirementCreator | `src/components/ai/AIRequirementCreator.tsx` | 2h |
| åˆ é™¤æ—§çš„æ¨¡æ¿æ–‡ä»¶ | `src/lib/templates/requirement-templates.ts` | 0.5h |

### 6.3 Phase 3ï¼šçœ‹æ¿é…ç½®åŠŸèƒ½ï¼ˆ3-4 å¤©ï¼‰

| ä»»åŠ¡ | ç»„ä»¶ | å·¥ä½œé‡ |
|------|------|--------|
| å®ç° KanbanConfigPanel | `src/components/kanban/KanbanConfigPanel.tsx` | 4h |
| å®ç° ColumnConfigurator | `src/components/kanban/ColumnConfigurator.tsx` | 3h |
| å®ç°æ³³é“è§†å›¾é€»è¾‘ | `src/components/kanban/useSwimlanes.ts` | 3h |
| å®ç° WIP é™åˆ¶é€»è¾‘ | `src/components/kanban/useWipLimits.ts` | 2h |
| æ›´æ–° DraggableBoard | `src/components/requirements/DraggableBoard.tsx` | 4h |
| æ·»åŠ é…ç½®å…¥å£æŒ‰é’® | `src/components/requirements/RequirementBoard.tsx` | 1h |

### 6.4 Phase 4ï¼šæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ1-2 å¤©ï¼‰

| ä»»åŠ¡ | è¯´æ˜ | å·¥ä½œé‡ |
|------|------|--------|
| å•å…ƒæµ‹è¯• | API å’Œç»„ä»¶æµ‹è¯• | 4h |
| é›†æˆæµ‹è¯• | ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯• | 3h |
| æ€§èƒ½ä¼˜åŒ– | ç¼“å­˜ã€æŸ¥è¯¢ä¼˜åŒ– | 2h |
| æ–‡æ¡£æ›´æ–° | API æ–‡æ¡£ã€ç”¨æˆ·æ‰‹å†Œ | 2h |

**æ€»å·¥ä½œé‡ä¼°ç®—ï¼š** 7-11 å¤©

---

## ä¸ƒã€é£é™©è¯„ä¼°

### 7.1 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| æ•°æ®åº“è¿ç§»å¤±è´¥ | é«˜ | å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼Œå¤‡ä»½ç”Ÿäº§æ•°æ® |
| JSON å­—æ®µæŸ¥è¯¢æ€§èƒ½ | ä¸­ | æ·»åŠ é€‚å½“çš„ç´¢å¼•ï¼Œè€ƒè™‘ä½¿ç”¨ PostgreSQL JSONB |
| æ‹–æ‹½æ€§èƒ½é—®é¢˜ | ä¸­ | ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼Œé™åˆ¶åŒæ—¶æ¸²æŸ“çš„å¡ç‰‡æ•° |
| çŠ¶æ€åŒæ­¥é—®é¢˜ | ä¸­ | ä½¿ç”¨ä¹è§‚æ›´æ–° + å¤±è´¥å›æ»š |

### 7.2 å…¼å®¹æ€§é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| æ—§æ•°æ®ä¸å…¼å®¹ | é«˜ | è¿ç§»æ—¶ä¸ºæ‰€æœ‰å·¥ä½œç©ºé—´åˆ›å»ºé»˜è®¤é…ç½® |
| API ç ´åæ€§å˜æ›´ | ä¸­ | ä¿æŒæ—§ API å¯ç”¨ï¼Œé€æ­¥åºŸå¼ƒ |
| å‰ç«¯ç¼“å­˜è„è¯» | ä½ | å¢åŠ ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³æ ¡éªŒ |

### 7.3 ç”¨æˆ·ä½“éªŒé£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| é…ç½®è¿‡äºå¤æ‚ | ä¸­ | æä¾›é¢„è®¾æ¨¡æ¿ï¼Œé»˜è®¤é…ç½® |
| å­¦ä¹ æ›²çº¿é™¡å³­ | ä¸­ | æ·»åŠ å¼•å¯¼æç¤ºå’Œå¸®åŠ©æ–‡æ¡£ |
| æ€§èƒ½ä¸‹é™ | é«˜ | æ‡’åŠ è½½é…ç½®ï¼Œå¢é‡æ›´æ–° |

---

## å…«ã€æˆåŠŸæŒ‡æ ‡

### 8.1 åŠŸèƒ½å®Œæ•´æ€§

- âœ… æ¨¡æ¿å®Œå…¨æ•°æ®åŒ–ï¼Œæ”¯æŒå·¥ä½œç©ºé—´çº§åˆ«é…ç½®
- âœ… çœ‹æ¿åˆ—å¯è‡ªå®šä¹‰ï¼Œæ”¯æŒæ·»åŠ /åˆ é™¤/é‡å‘½å/æ’åº
- âœ… æ”¯æŒæ³³é“è§†å›¾ï¼ˆæŒ‰è´Ÿè´£äººã€ä¼˜å…ˆçº§ã€æ ‡ç­¾ï¼‰
- âœ… æ”¯æŒ WIP é™åˆ¶å’Œè¶…é™è­¦å‘Š

### 8.2 æ€§èƒ½æŒ‡æ ‡

- çœ‹æ¿åŠ è½½æ—¶é—´ < 500ms
- æ‹–æ‹½å“åº”å»¶è¿Ÿ < 100ms
- API å“åº”æ—¶é—´ < 200ms (P95)

### 8.3 ç”¨æˆ·ä½“éªŒ

- é…ç½®ç•Œé¢ç›´è§‚æ˜“ç”¨ï¼Œæ–°ç”¨æˆ· 5 åˆ†é’Ÿå†…å¯å®Œæˆé¦–æ¬¡é…ç½®
- æ¨¡æ¿åˆ›å»ºæµç¨‹ < 30 ç§’
- çœ‹æ¿é…ç½®åˆ‡æ¢ < 1 ç§’

---

## ä¹ã€åç»­ä¼˜åŒ–æ–¹å‘

### 9.1 æ¨¡æ¿ç³»ç»Ÿå¢å¼º

- æ¨¡æ¿å¯¼å…¥/å¯¼å‡ºåŠŸèƒ½
- æ¨¡æ¿å¸‚åœºï¼ˆè·¨å·¥ä½œç©ºé—´åˆ†äº«ï¼‰
- AI ç”Ÿæˆæ¨¡æ¿å»ºè®®
- æ¨¡æ¿ç‰ˆæœ¬å†å²

### 9.2 çœ‹æ¿ç³»ç»Ÿå¢å¼º

- è‡ªå®šä¹‰å­—æ®µ
- çœ‹æ¿æ¨¡æ¿
- æ—¶é—´çº¿è§†å›¾
- ç‡ƒå°½å›¾/ç‡ƒèµ·å›¾

### 9.3 å·¥ä½œç©ºé—´å¢å¼º

- å·¥ä½œç©ºé—´å¤åˆ¶åŠŸèƒ½ï¼ˆåŒ…å«é…ç½®ï¼‰
- å·¥ä½œç©ºé—´å½’æ¡£
- å·¥ä½œç©ºé—´æƒé™ç»†åˆ†ï¼ˆåˆ—çº§åˆ«æƒé™ï¼‰

---

## åã€é™„å½•

### 10.1 ç›¸å…³æ–‡æ¡£

- [æ¶æ„è¯„ä¼°.md](./æ¶æ„è¯„ä¼°.md) - ç³»ç»Ÿæ¶æ„æ¦‚è¿°
- [API.md](./API.md) - API æ–‡æ¡£
- [éƒ¨ç½²æ‰‹å†Œ.md](./éƒ¨ç½²æ‰‹å†Œ.md) - éƒ¨ç½²æŒ‡å—

### 10.2 å‚è€ƒèµ„æ–™

- [Prisma JSON ç±»å‹](https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference#string-visual)
- [Dnd-Kit æ–‡æ¡£](https://docs.dndkit.com/)
- [shadcn/ui ç»„ä»¶](https://ui.shadcn.com/)

### 10.3 å˜æ›´å†å²

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´å†…å®¹ | ä½œè€… |
|------|------|---------|------|
| 2026-02-08 | 1.0 | åˆå§‹ç‰ˆæœ¬ | ç³»ç»Ÿæ¶æ„å¸ˆ |

---

**æ–‡æ¡£çŠ¶æ€ï¼š** ğŸŸ¢ è§„åˆ’ä¸­
**ä¸‹ä¸€æ­¥ï¼š** æŠ€æœ¯è¯„å®¡ä¸èµ„æºåˆ†é…
